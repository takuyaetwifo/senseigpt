<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Prism.js（コード表示の整形用） -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <script>
    function copyToClipboard(button) {
      const code = button.nextElementSibling.querySelector("code");
      if (!code) return;

      const text = code.innerText;
      navigator.clipboard.writeText(text).then(() => {
        button.textContent = "✅ コピーしました！";
        setTimeout(() => {
          button.textContent = "📋 コピー";
        }, 1500);
      });
    }
  </script>

  <title>せんせいGPT</title>
</head>

<body style="background-color: {{ theme_color }};">
  <div class="header">
    ログイン中: {{ display_name }} さん |
    <a href="{{ url_for('settings') }}">設定</a>
    <a href="/logout">ログアウト</a>
  </div>

  {% if session['role'] == 'admin' %}
  <a href="{{ url_for('admin_edit_profile', user_id=session['user_id']) }}">自分のプロフィール編集</a>
  {% endif %}

  <h2 style="display: flex;align-items: center; gap: 20px;">
    {% if user_icon %}
      <img src="{{ url_for('static', filename='uploads/' ~ user_icon) }}" alt="アイコン" width="100" height="100" style="vertical-align: middle; border-radius: 50%;">
    {% endif %}
    せんせいGPT
    {% if lesson %}
      <span style="font-size: 16px; background-color: #eef; padding: 6px 10px; border-radius: 8px;">
        📘 きょうのおべんきょう：{{ lesson }}
      </span>
    {% endif %}
  </h2>

  {% if birthday_today %}
  <div style="color: red; font-size: 1.2em; font-weight: bold;">
    🎂 お誕生日おめでとうございます！素敵な1日になりますように 🎉
  </div>
  {% endif %}

  <form method="POST" action="/chat">
    <input type="text" name="message" required>
    <button type="submit">送信</button>
  </form>

  <form action="{{ url_for('clear_chat') }}" method="POST" onsubmit="return confirm('本当に削除しますか？');">
    <button type="submit">履歴をすべて削除</button>
  </form>

  <div class="chat-log">
    {% if rows %}
      <ul>
        {% for row in rows %}
          <div class="message user"><strong>あなた:</strong> {{ row.user_input }}</div><br>
          <div class="message gpt"><strong>先生:</strong> {{ row.gpt_response | safe }}</div>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</body>
</html>
