<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Prism.jsï¼ˆã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã®æ•´å½¢ç”¨ï¼‰ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <script>
    function copyToClipboard(button) {
      const code = button.nextElementSibling.querySelector("code");
      if (!code) return;

      const text = code.innerText;
      navigator.clipboard.writeText(text).then(() => {
        button.textContent = "âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
        setTimeout(() => {
          button.textContent = "ğŸ“‹ ã‚³ãƒ”ãƒ¼";
        }, 1500);
      });
    }
  </script>

  <title>ã›ã‚“ã›ã„GPT</title>
</head>

<body style="background-color: {{ theme_color }};">
  <div class="header">
    ãƒ­ã‚°ã‚¤ãƒ³ä¸­: {{ display_name }} ã•ã‚“ |
    <a href="{{ url_for('settings') }}">è¨­å®š</a>
    <a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
  </div>

  {% if session['role'] == 'admin' %}
  <a href="{{ url_for('admin_edit_profile', user_id=session['user_id']) }}">è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</a>
  {% endif %}

  <h2 style="display: flex;align-items: center; gap: 20px;">
    {% if user_icon %}
      <img src="{{ url_for('static', filename='uploads/' ~ user_icon) }}" alt="ã‚¢ã‚¤ã‚³ãƒ³" width="100" height="100" style="vertical-align: middle; border-radius: 50%;">
    {% endif %}
    ã›ã‚“ã›ã„GPT
    {% if lesson %}
      <span style="font-size: 16px; background-color: #eef; padding: 6px 10px; border-radius: 8px;">
        ğŸ“˜ ãã‚‡ã†ã®ãŠã¹ã‚“ãã‚‡ã†ï¼š{{ lesson }}
      </span>
    {% endif %}
  </h2>

  {% if birthday_today %}
  <div style="color: red; font-size: 1.2em; font-weight: bold;">
    ğŸ‚ ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ç´ æ•µãª1æ—¥ã«ãªã‚Šã¾ã™ã‚ˆã†ã« ğŸ‰
  </div>
  {% endif %}

  <form method="POST" action="/chat">
    <input type="text" name="message" required>
    <button type="submit">é€ä¿¡</button>
  </form>

  <form action="{{ url_for('clear_chat') }}" method="POST" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
    <button type="submit">å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤</button>
  </form>

  <div class="chat-log">
    {% if rows %}
      <ul>
        {% for row in rows %}
          <div class="message user"><strong>ã‚ãªãŸ:</strong> {{ row.user_input }}</div><br>
          <div class="message gpt"><strong>å…ˆç”Ÿ:</strong> {{ row.gpt_response | safe }}</div>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</body>
</html>
